<% provide(:title, "Show conversation") %>

<%= @conversation.title%>


<ul>
	<% @conversation.posts.where(parent: @conversation).each do |f| %>
		<li><%= render '/posts/show', :post => f %></li>
	<% end %>
</ul>

<ul>
	<% @conversation.calls.where(parent: @conversation).each do |f| %>
		<li><%= render '/calls/show', :call => f  %></li>
	<% end %>	

	<% if @conversation.child_aftfs.select{|x| !x.accepted }.any? %>
		<% @conversation.child_aftfs.select{|x| !x.accepted }.each do |x| %>
			<li>
			<%= render '/aftfs/show', :aftf => x %>
			</li>
		<% end %>
	<% end %>
</ul>
<%= "AFTF IN THE AIR: " if @conversation.aftfs.select{|x| x.alive? }.any? %>
<ul>
	<% @conversation.aftfs.select{|x| x.alive? }.each do |f| %>
		<li><%= render '/aftfs/show', :aftf => f %></li>
	<% end %>	
</ul>


<% if user_signed_in? %>
	<br/>
	<%= render '/aftfs/new', :aftf => [@conversation, @aftf] if current_user.can_aftf?(@conversation)%>
	<br/>
	<%= render '/posts/new', :post => [@conversation, @post] if current_user.can_post?(@conversation)%>
	<br/>
	<%= render '/calls/new', :call => [@conversation, @call] if current_user.can_call?(@conversation) %> 
	<br/>
<% end %>
